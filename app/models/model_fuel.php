<?php
require_once __DIR__.'/../includes/database.php';
class Model_fuel {

    protected $retryTimes = 4;
    protected $debug = 0;

    
    public function getIOCLpriceByLatLong($params = array()) {
        $return = array('error' => 1, 'errorCode' => 'generic error', 'data' => array());
        $data = array();
        $params['lat'] = isset($params['lat']) ? $params['lat'] : '19.0759837';
        $params['long'] = isset($params['long']) ? $params['long'] : '72.87765590000004';
        $p = array();
        $p['url'] = "https://associates.indianoil.co.in/PumpLocator/NearLocations";
        $p['method'] = 'POST';
        $p['postvars'] = "latitude={$params['lat']}&longitude={$params['long']}";
        $res = makeCURLRequest($p);
        //p($res);

        if ($res['error'] == 0 && !empty($res['data'])) {
            $rows = explode('|', $res['data']);
            $dd = explode(',', $rows[0]);
            if (isset($dd[25]) && isset($dd[26])) {
                $data = array('patrol' => $dd[25], 'diesel' => $dd[26]);
            }
            //ASHA AUTO SERVICE,19.070026,72.875066,142 LBS MARG KURLA WEST MUMBAI - 400070,Yes,YES, , , , , , , , , ,00:30-23:30,101,100, ,Yes,YES,YES,YES,YES,YES,78.54,69.01,81.29,72.20,919176364124,THAPPAR HARSH -THAPPAR NARESH ,Maharashtra SO,Mumbai DO,Mumbai East RSA,GREATER MUMBAI,Maharashtra,9820727091,0.72
        }
        if (!empty($data)) {
            $return = array('error' => 0, 'errorCode' => '', 'data' => $data);
        }
        return $return;
    }

    public function getIOCLpriceByDistrict($params = array()) {
        $today = date('H') >= 6 ? date('Y-m-d') : date('Y-m-d', strtotime('-1 day'));
        $cityData = [];
        
        $districts = $this->getAllCities();//$this->query_to_array("SELECT id,codeIOCL FROM city order by stateCode");
        //$districts = [end($districts)];
        //p($districts);
        //$districts = $this->query_to_array("SELECT id,codeIOCL FROM city WHERE id='621' order by stateCode ");
        $i = 0;
        foreach ($districts as $dist) {
            //if($i>5)break;
            $i++;
            $p = array();
            $p['url'] = "https://associates.indianoil.co.in/PumpLocator/DistrictWiseLocator";
            $p['method'] = 'POST';
            $p['postvars'] = "district={$dist['code']}";
            $res = makeCURLRequest($p);
            //p($res);

            if ($res['error'] == 0 && !empty($res['data'])) {
                $rows = explode('|', $res['data']);

                $j = 0;
                while ($j <= count($rows)) {
                    $dd = explode(',', $rows[$j]);
                    if (intval($dd[25]) > 0 && intval($dd[26]) > 0) {
                        break;
                    }
                    ++$j;
                }

                if (isset($dd[25]) && isset($dd[26]) && $dd[25] != 'null' && $dd[26] != 'null' && intval($dd[25])>0 && intval($dd[26])>0) {
                    $cityData1=[];
                    $dd[25] = floatval($dd[25]);
                    $dd[26] = floatval($dd[26]);
                    $dd[1] = floatval($dd[1]);
                    $dd[2] = floatval($dd[2]);
                    $cityData[$dist['code']] = ['date'=>$today,'petrol'=>$dd[25],'diesel'=>$dd[26],'lat'=>$dd[1],'long'=>$dd[2]] + $dist;
                    echo "<pre>";
                    $cityData1=$cityData[$dist['code']];
                    print_r($cityData1);
                    
                    $dbMod=new DB();
                  echo $quer="insert into petrol_disel_rate set data_date='".$cityData1['date']."',petrol='".$cityData1['petrol']."',disel='".$cityData1['diesel']."',lat='".$cityData1['lat']."',`long`='".$cityData1['long']."',`code`='".$cityData1['code']."',statecode='".$cityData1['stateCode']."',statename='".$cityData1['stateName']."',cityname='".$cityData1['cityName']."',created_at='".date("Y-m-d H:i:s")."',status='1'";

                    $dbMod->query($quer);

                    //$data[] = array('lat' => $dd[1], 'long' => $dd[2],'code' => $dis[0], 'name' => $dis[1],'district' => $dd[34], 'state' => $dd[35], 'patrol' => $dd[25], 'diesel' => $dd[26]);
                }
                //ASHA AUTO SERVICE,19.070026,72.875066,142 LBS MARG KURLA WEST MUMBAI - 400070,Yes,YES, , , , , , , , , ,00:30-23:30,101,100, ,Yes,YES,YES,YES,YES,YES,78.54,69.01,81.29,72.20,919176364124,THAPPAR HARSH -THAPPAR NARESH ,Maharashtra SO,Mumbai DO,Mumbai East RSA,GREATER MUMBAI,Maharashtra,9820727091,0.72
            }

            usleep(500);
        }

        return $cityData;
    }
    
    public function getAllCities() {

        $districts = "TG001,ADILABAD|MP051,AGAR  MALWA|UP001,AGRA|MH001,AHMADNAGAR|GJ001,AHMEDABAD|MZ001,AIZAWL|RJ001,AJMER|MH002,AKOLA|KL001,ALAPPUZHA|UP002,ALIGARH|WB020,ALIPURDUAR|MP050,ALIRAJPUR|UP003,ALLAHABAD|UA001,ALMORA|RJ002,ALWAR|HR001,AMBALA|UP004,AMBEDKARNAGAR|UP074,AMETHI/CSM NAGAR|MH003,AMRAVATI|GJ002,AMRELI|PB001,AMRITSAR|UP038,AMROHA|GJ003,ANAND|AP002,ANANTAPUR|JK001,ANANTNAG|OR001,ANGUL|MP047,ANUPUR|BR001,ARARIA|GJ027,ARAVALLI|TN041,ARIYALUR|BR039,ARWAL|MP048,ASHOKNAGAR|UP005,AURAIYA|BR002,AURANGABAD|MH004,AURANGABAD|UP006,AZAMGARH|JK004,BADGAM|MP001,BADWANI|KA001,BAGALKOT|UA002,BAGESHWAR|UP007,BAGHPAT|UP008,BAHRAICH|AS026,BAKSA|MP002,BALAGHAT|OR003,BALESHWAR|UP009,BALLIA|CT024,BALOD|CT021,BALODABAZAR|CT027,BALRAMPUR|UP010,BALRAMPUR|GJ004,BANAS KANTHA|UP011,BANDA|JK020,BANDIPORA|KA002,BANGALORE|KA027,BANGALORE RURAL|BR003,BANKA|WB001,BANKURA|RJ003,BANSWARA|UP012,BARABANKI|JK003,BARAMULLAH|RJ004,BARAN|UP013,BAREILLY|OR004,BARGARH|RJ005,BARMER|PB020,BARNALA|AS001,BARPETA|CT001,BASTAR|UP014,BASTI|PB002,BATHINDA|BR004,BEGUSARAI|KA003,BELGAUM|KA004,BELLARY|CT023,BEMETARA|MP003,BETUL|TG020,BHADRADRI KOTHAGUDEM|OR006,BHADRAK|BR006,BHAGALPUR|MH005,BHANDARA|RJ006,BHARATPUR|GJ005,BHARUCH|GJ006,BHAVNAGAR|RJ007,BHILWARA|MP004,BHIND|HR006,BHIWANI|BR007,BHOJPUR|MP005,BHOPAL|MH006,BID|KA005,BIDAR|CT017,BIJAPUR|KA006,BIJAPUR|UP015,BIJNOR|RJ008,BIKANER|CT002,BILASPUR|HP001,BILASPUR|WB003,BIRBHUM|MN001,BISHNUPUR|JH001,BOKARO|OR002,BOLANGIR|AS024,BONGAIGAON|GJ029,BOTAD|OR005,BOUDH|UP016,BUDAUN|UP017,BULANDSHAHR|MH007,BULDHANA|RJ009,BUNDI|MP046,BURHANPUR|BR008,BUXAR|AS032,Biswanath|AS003,CACHAR|HP002,CHAMBA|UA003,CHAMOLI|UA004,CHAMPAWAT|MZ007,CHAMPHAI|KA007,CHAMRAJNAGAR|UP018,CHANDAULI|MN002,CHANDEL|CH001,CHANDIGARH|MH008,CHANDRAPUR|AR001,CHANGLANG|HR022,CHARKI DADRI|JH002,CHATRA|TN001,CHENNAI|MP006,CHHATARPUR|MP007,CHHINDWARE|GJ030,CHHOTAUDEPUR|KA028,CHIKKABALLAPURA|KA008,CHIKMAGALUR|AS002,CHIRANG|KA009,CHITRADURGA|UP019,CHITRAKUT|RJ010,CHITTAURGARH|AP003,CHITTOOR|MN003,CHURACHANDPUR|RJ011,CHURU|TN002,COIMBATORE|WB005,COOCH BIHAR|TN003,CUDDALORE|AP004,CUDDAPAH|OR007,CUTTACK|DL005,Central Delhi|AS030,Charaideo|GJ007,DAHOD|WB006,DAKSHIN DINAJPUR|KA010,DAKSHIN KANNAD|DD001,DAMAN|MP008,DAMOH|CT003,DANTEWADA|BR009,DARBHANGA|WB007,DARJEELING|AS004,DARRANG|MP009,DATIA|RJ012,DAUSA|KA011,DAVANGERE|UA005,DEHRADUN|JH003,DEOGARH|OR008,DEOGARH|UP020,DEORIA|GJ033,DEVBHUMI DWARKA|MP010,DEWAS|TR004,DHALAI|CT004,DHAMTARI|JH004,DHANBAD|MP011,DHAR|TN004,DHARMAPURI|KA012,DHARWAD|RJ013,DHAULPUR|AS005,DHEMAJI|OR009,DHENKANAL|AS006,DHUBURI|MH010,DHULE|AR002,DIBANG VALLEY|AS007,DIBRUGARH|AS020,DIMA HASAO|NL008,DIMAPUR|TN005,DINDIGUL|MP012,DINDORI|DD002,DIU|JK012,DODA|JH005,DUMKA|RJ014,DUNGARPUR|CT005,DURG|DL011,Delhi Shahdara|BR026,EAST CHAMPARAN|SK001,EAST DISTRICT|ML001,EAST GARO HILLS|AP005,EAST GODAVARI|MN009,EAST IMPHAL|ML008,EAST JAINTIA HILLS|AR003,EAST KHAMENG|ML002,EAST KHASI HILLS|AR004,EAST SIANG|JH006,EAST SINGHBHUM|KL002,ERNAKULAM|TN006,ERODE|UP021,ETAH|UP022,ETAWAH|DL004,East Delhi|UP023,FAIZABAD|HR016,FARIDABAD|PB003,FARIDKOT|UP024,FARRUKKHABAD|HR011,FATEHABAD|PB004,FATEHGARH SAHIB|UP025,FATEHPUR|PB022,FAZILKA|UP026,FIROZABAD|PB005,FIROZPUR|KA013,GADAG|MH011,GADCHIROLI|OR010,GAJAPATI|JK022,GANDERBAL|GJ008,GANDHI NAGAR|RJ015,GANGANAGAR|OR011,GANJAM|JH007,GARHWA|CT022,GARIYABAND|UP027,GAUTAM BUDH NAGAR|BR010,GAYA|UP028,GHAZIABAD|UP029,GHAZIPUR|GJ028,GIR SOMNATH|JH008,GIRIDIH|AS008,GOALPARA|JH009,GODDA|AS009,GOLAGHAT|TR007,GOMATI|UP030,GONDA|MH033,GONDIA|BR011,GOPALGANJ|UP031,GORAKHPUR|MH012,GREATER MUMBAI|KA014,GULBARGA|JH010,GUMLA|MP014,GUNA|AP006,GUNTUR|PB006,GURDASPUR|HR002,GURGAON|MP015,GWALIOR|AS010,HAILAKANDI|HP003,HAMIRPUR|UP032,HAMIRPUR|RJ016,HANUMANGARH|UP077,HAPUR|MP016,HARDA|UP033,HARDOI|UA006,HARIDWAR|KA015,HASSAN|UP034,HATHRAS|KA016,HAVERI|JH011,HAZARIBAGH|MH034,HINGOLI|HR007,HISAR|WB008,HOOGHLY|MP017,HOSHANGABAD|PB007,HOSHIARPUR|WB009,HOWRAH|TG010,HYDERABAD|AS028,Hojai|KL003,IDUKKI|MP018,INDORE|MP019,JABALPUR|OR012,JAGATSINGHPUR|TG013,JAGITIAL|BR012,JAHANABAD|MP020,JAHBUA|ML003,JAINTIA HILLS|RJ017,JAIPUR|RJ018,JAISALMER|OR013,JAJPUR|PB008,JALANDHAR|UP035,JALAUN|MH013,JALGAON|MH014,JALNA|RJ019,JALOR|WB010,JALPAIGURI|JK005,JAMMU|GJ009,JAMNAGAR|JH021,JAMTARA|BR013,JAMUI|TG018,JANGAON|CT006,JANJGIR|CT007,JASHPUR|UP036,JAUNPUR|TG031,JAYASHANKAR BHUPALPA|HR012,JHAJJAR|RJ020,JHALAWAR|UP037,JHANSI|WB024,JHARGRAM|OR014,JHARSUGUDA|RJ021,JHUNJHUNUN|HR017,JIND|MN016,JIRIBAM|RJ022,JODHPUR|TG025,JOGULAMBA GADWAL|AS011,JORHAT|GJ010,JUNAGADH|BR005,KAIMUR|HR003,KAITHAL|MN014,KAKCHING|OR015,KALAHANDI|WB021,KALIMPONG|TG016,KAMAREDDY|AS012,KAMRUP|TN007,KANCHIPURAM|OR025,KANDHAMAL|MN012,KANGPOKPI|HP004,KANGRA|CT008,KANKER|TN008,KANNIYAKUMARI|UP039,KANNUAJ|KL004,KANNUR|UP040,KANPUR RURAL|UP041,KANPUR URBAN|PB009,KAPURTHALA|PY003,KARAIKAL|RJ023,KARAULI|AS013,KARBI ANGLONG|JK009,KARGIL|TG002,KARIM NAGAR|AS014,KARIMGANJ|HR008,KARNAL|TN009,KARUR|KL005,KASARAGOD|UP073,KASHI RAM NAGAR|JK007,KATHUA|BR014,KATIHAR|MP021,KATNI|UP042,KAUSHAMBI|CT009,KAWARDHA|OR016,KENDRAPARA|OR017,KEONJHAR|BR015,KHAGARIA|TG003,KHAMMAM|MP013,KHANDWA|MP045,KHARGONE|GJ011,KHEDA|OR018,KHORDHA|TR005,KHOWAI|JH023,KHUNTI|HP005,KINNAUR|NL010,KIPHERE|BR016,KISHANGANJ|JK016,KISHTWAR|KA017,KODAGU|JH012,KODERMA|NL001,KOHIMA|AS015,KOKRAJHAR|KA018,KOLAR|MZ006,KOLASIB|MH015,KOLHAPUR|WB004,KOLKATA|KL006,KOLLAM|TG012,KOMRAM BHEEM ASIFABA|CT020,KONDAGAON|KA019,KOPPAL|OR019,KORAPUT|CT010,KORBA|CT011,KORIA|RJ024,KOTA|KL007,KOTTAYAM|KL008,KOZHIKODE|AP009,KRISHNA|TN033,KRISHNAGIRI|JK021,KULGAM|HP006,KULLU|JK010,KUPWARA|AP010,KURNOOL|HR013,KURUKSHETRA|UP043,KUSHINAGAR|GJ012,KUTCH|AS027,Kamrup Metro|HP007,LAHUL &amp; SPITI|AS016,LAKHIMPUR|UP044,LAKHIMPUR|UP045,LALITPUR|JH019,LATEHAR|MH016,LATUR|MZ004,LAWNGTLAI|JK008,LEH|JH013,LOHARDAGA|AR005,LOHIT|AR017,LONGDING|NL009,LONGLENG|AR012,LOWER DIBANG VALLEY|AR006,LOWER SUBANSIRI|BR017,LUCKEESARAI|UP046,LUCKNOW|PB010,LUDHIANA|MZ003,LUNGLEI|BR018,MADHEPURA|BR019,MADHUBANI|TN010,MADURAI|TG019,MAHABUBABAD|UP047,MAHARAJGANJ|CT012,MAHASAMUND|PY001,MAHE|HR018,MAHENDRAGARH|GJ031,MAHISAGAR|UP048,MAHOBA|UP049,MAINPURI|AS035,MAJULI|KL009,MALAPPURAM|WB011,MALDA|OR020,MALKANGIRI|MZ005,MAMIT|TG030,MANCHERIAL|HP008,MANDI|MP022,MANDLA|MP023,MANDSAUR|KA020,MANDYA|PB011,MANSA|UP050,MATHURA|UP051,MAUNATHBHANJAN|OR021,MAYURBHANJ|TG004,MEDAK|TG029,MEDCHAL MALKAJGIRI|UP052,MEERUT|TG005,MEHABUBNAGAR|GJ013,MEHSANA|HR021,MEWAT|UP053,MIRZAPUR|PB012,MOGA|NL002,MOKOKCHUNG|NL003,MON|UP054,MORADABAD|GJ032,MORBI|MP024,MORENA|AS017,MORIGAON|PB013,MUKTSAR|TG032,MULUGU|MH036,MUMBAI CITY|CT025,MUNGELI|BR020,MUNGER|WB013,MURSHIDABAD|UP055,MUZAFFARNAGAR|BR021,MUZAFFARPUR|KA021,MYSORE|OR022,NABARANGAPUR|WB014,NADIA|AS018,NAGAON|TN011,NAGAPATTINAM|TG024,NAGARKURNOOL|RJ025,NAGAUR|MH017,NAGPUR|UA007,NAINITAL|BR022,NALANDA|AS019,NALBARI|TG006,NALGONDA|TN012,NAMAKKAL|MH018,NANDED|MH019,NANDURBAR|TG033,NARAYANPET|GJ014,NARMADA|MP025,NARSIMHAPUR|MH020,NASHIK|GJ015,NAVSARI|BR023,NAWADA|OR023,NAYAGARH|MP026,NEEMACH|AP014,NELLORE|AN003,NICOBAR|TN013,NILGIRIS|TG011,NIRMAL|TG007,NIZAMABAD|MN013,NONEY|WB015,NORTH 24 PARGANAS|SK002,NORTH DISTRICT|ML011,NORTH GARO HILLS|GO001,NORTH GOA|TR001,NORTH TRIPURA|AN002,NORTH&amp;MIDDLE ANDAMAN|OR024,NUAPARHA|AR019,Namsai|DL006,New Delhi|DL002,North Delhi|DL003,North East Delhi|DL001,North West Delhi|MH009,OSMANABAD|JH014,PAKUR|KL010,PALAKKAD|JH015,PALAMAU|MH035,PALGHAR|RJ026,PALI|HR020,PALWAL|GJ016,PANCH MAHAL|HR004,PANCHKULA|HR009,PANIPAT|MP027,PANNA|AR014,PAPUMPARE|MH021,PARBHANI|WB023,PASCHIM BARDHAMAN|WB019,PASCHIM MEDINIPUR|GJ017,PATAN|KL011,PATHANANTHITTA|PB021,PATHANKOT|PB015,PATIALA|BR025,PATNA|UA008,PAURI|TG014,PEDDAPALLI|TN014,PERAMBALUR|NL011,PEREN|NL004,PHEK|MN011,PHERZAWL|UP056,PILIBHIT|UA009,PITHORAGARH|PY002,PONDICHERRY|JK011,POONCH|GJ018,PORBANDER|AP016,PRAKASAM|RJ033,PRATAPGARH|UP057,PRATAPGARH|TN015,PUDUKKOTTAI|JK002,PULWAMA|MH022,PUNE|WB022,PURBA BARDHAMAN|WB012,PURBA MEDINIPUR|OR026,PURI|BR027,PURNIA|WB016,PURULIA|UP058,RAE BARELI|KA022,RAICHUR|CT013,RAIGARH|MH023,RAIGARH|CT014,RAIPUR|MP028,RAISEN|TG015,RAJANNA SIRCILLA|MP029,RAJGARH|GJ019,RAJKOT|CT015,RAJNANDGAON|JK013,RAJOURI|RJ027,RAJSAMAND|KA029,RAMANAGARA|TN016,RAMANATHAPURAM|JK019,RAMBAN|JH024,RAMGARH|UP059,RAMPUR|JH016,RANCHI|TG008,RANGAREDDI|MP030,RATLAM|MH024,RATNAGIRI|OR027,RAYAGADA|JK018,REASI|MP031,REWA|HR014,REWARI|ML007,RI BHOI|HR019,ROHTAK|BR028,ROHTAS|UA010,RUDRAPRAYAG|PB016,RUPNAGAR|GJ020,SABAR KANTHA|MP032,SAGAR|UP060,SAHARANPUR|BR029,SAHARSA|JH017,SAHIBGANJ|MZ002,SAIHA|TN017,SALEM|BR030,SAMASTIPUR|JK017,SAMBA|OR028,SAMBALPUR|UP075,SAMBHAL|TG021,SANGAREDDY|MH025,SANGLI|PB017,SANGRUR|UP061,SANT KABIR NAGAR|UP062,SANT RAVI NAGAR|JH022,SARAIKELA KHARASAWAN|BR031,SARAN|PB019,SAS NAGAR|MH026,SATARA|MP033,SATNA|RJ028,SAWAIMADHOPUR|MP034,SEHORE|MN005,SENAPATI|MP035,SEONI|TR006,SEPAHIJHALA|MZ008,SERCHHIP|BR032,SEWAN|MP036,SHAHDOL|UP063,SHAHJAHANPUR|MP037,SHAJAPUR|UP076,SHAMLI|PB014,SHD BHAGAT SINGH NGR|BR033,SHEIKHPURA|BR034,SHEOHAR|MP038,SHEOPUR|HP009,SHIMLA|KA023,SHIMOGA|MP039,SHIVPURI|JK015,SHOPIAN|UP064,SHRAVASTI|AS021,SIBSAGAR|TG022,SIDDIPET|UP065,SIDHARTHNAGAR|MP040,SIDHI|RJ029,SIKAR|DN001,SILVASSA|JH020,SIMDEGA|MH027,SINDHUDURG|MP049,SINGRAULI|HP010,SIRMAUR|RJ030,SIROHI|HR005,SIRSA|BR035,SITAMARHI|UP066,SITAPUR|TN018,SIVAGANGA|HP011,SOLAN|MH028,SOLAPUR|OR029,SONAPUR|UP067,SONBHADRA|HR010,SONIPAT|AS022,SONITPUR|WB017,SOUTH 24 PARGANAS|AN001,SOUTH ANDAMAN|SK003,SOUTH DISTRICT|ML006,SOUTH GARO HILLS|GO002,SOUTH GOA|TR002,SOUTH TRIPURA|ML010,SOUTHWEST KHASI HILS|AP018,SRIKAKULAM|JK006,SRINAGAR|CT019,SUKMA|UP068,SULTANPUR|OR030,SUNDARGARH|BR036,SUPAUL|CT026,SURAJPUR|GJ021,SURAT|GJ022,SURENDRANAGAR|CT016,SURGUJA|TG026,SURYAPET|DL007,South Delhi|DL010,South East Delhi|DL008,South West Delhi|MN006,TAMENGLONG|GJ026,TAPI|PB018,TARN TARAN|AR007,TAWANG|UA011,TEHRI GARHWAL|MN010,TENGNOUPAL|TN019,TENI|MH029,THANE|TN020,THANJAVUR|GJ023,THE DANGS|KL012,THIRUVANANTHAPURAM|TN021,THIRUVARUR|MN007,THOUBAL|KL013,THRISSUR|MP041,TIKAMGARH|AS023,TINSUKIA|AR008,TIRAP|TN022,TIRUCHCHIRAPPALLI|TN023,TIRUNELVELI|TN040,TIRUPUR|TN024,TIRUVALLUR|TN025,TIRUVANNAMALAI|RJ031,TONK|NL005,TUENSANG|KA024,TUMKUR|TN026,TUTICORIN|RJ032,UDAIPUR|AS025,UDALGURI|UA012,UDHAM SINGH NAGAR|JK014,UDHAMPUR|KA025,UDUPI|MP042,UJJAIN|MN008,UKHRUL|MP043,UMARIA|HP012,UNA|TR008,UNAKOTI|UP069,UNNAO|AR013,UPPER SIANG|AR009,UPPER SIBANSIRI|WB018,UTTAR DINAJPUR|KA026,UTTAR KANNAD|UA013,UTTARKASHI|GJ024,VADODARA|BR037,VAISHALI|GJ025,VALSAD|UP070,VARANASI|TN027,VELLORE|MP044,VIDISHA|TG028,VIKARABAD|TN028,VILUPPURAM|TN029,VIRUDUNAGAR|AP019,VISHAKHAPATNAM|AP020,VIZIANAGARAM|TG023,WANAPARTHY|TG009,WARANGAL|TG017,WARANGAL RURAL|MH030,WARDHA|MH031,WASHIM|KL014,WAYANAD|BR024,WEST CHAMPARAN|SK004,WEST DISTRICT|ML004,WEST GARO HILLS|AP022,WEST GODAVARI|MN004,WEST IMPHAL|AR010,WEST KAMENG|ML005,WEST KHASI HILLS|AR011,WEST SIANG|JH018,WEST SINGHBHUM|TR003,WEST TRIPURA|NL006,WOKHA|DL009,West Delhi|AS029,West Karbi Anglong|TG027,YADADRI BHUVANAGIRI|KA030,YADGIR|HR015,YAMUNANAGAR|PY004,YANAM|MH032,YAVATMAL|NL007,ZUNHEBOTO";
        $districts = explode('|', $districts);
        $states = array("AN" => "Andaman and Nicobar", "AP" => "Andhra Pradesh", "AR" => "Arunachal Pradesh", "AS" => "Assam", "BR" => "Bihar", "CH" => "Chandigarh", "CT" => "Chhatisgarh", "DN" => "Dadra Nagarhaveli", "DD" => "Daman and Diu", "DL" => "Delhi", "GO" => "Goa", "GJ" => "Gujarat", "HR" => "Haryana", "HP" => "Himachal Pradesh", "JK" => "Jammu and Kashmir", "JH" => "Jharkhand", "KA" => "Karnataka", "KL" => "Kerala", "MP" => "Madhya Pradesh", "MH" => "Maharashtra", "MN" => "Manipur", "ML" => "Meghalaya", "MZ" => "Mizoram", "NL" => "Nagaland", "OR" => "Odisha", "PY" => "Pondicherry", "PB" => "Punjab", "RJ" => "Rajasthan", "SK" => "Sikkim", "TN" => "Tamil Nadu", "TG" => "Telangana", "TR" => "Tripura", "UP" => "Uttar Pradesh", "UA" => "Uttarakhand", "WB" => "West Bengal");

        $allCities = [];
        foreach ($districts as $dis) {
            $dis = explode(',', $dis);
            $stateCode = substr($dis[0], 0, 2);
            $allCities[$dis[0]] = ["code"=>$dis[0],"stateCode"=>$stateCode,"stateName"=>$states[$stateCode],"cityName"=>$dis[1]];
        }

        return $allCities;
    }
    
    

    public function patrolPriceHistory($check = false) {
        $p = array();
        $p['url'] = "https://www.iocl.com/Product_PreviousPrice/PetrolPreviousPriceDynamic.aspx";
        $p['method'] = 'GET';
        $p['timeout'] = 10;
        $res = makeCURLRequest($p);
        //p($res);
        $history = array();
        if ($res['error'] == 0 && !empty($res['data'])) {
            $html = str_get_html($res['data']);
            foreach ($html->find('table[class="generic-table general-table"] tr') as $tr) {
                if ($tr->find('span', 0)) {
                    $history[regix_string($tr->find('span', 0)->plaintext)] = array(
                        '474' => array('patrol' => trim($tr->find('span', 1)->plaintext)),
                        '351' => array('patrol' => trim($tr->find('span', 2)->plaintext)),
                        '431' => array('patrol' => trim($tr->find('span', 3)->plaintext)),
                        '122' => array('patrol' => trim($tr->find('span', 4)->plaintext)),
                    );
                }
            }
        }
        sleep(2);
        $p = array();
        $p['url'] = "https://www.iocl.com/Product_PreviousPrice/DieselPreviousPriceDynamic.aspx";
        $p['method'] = 'GET';
        $p['timeout'] = 10;
        $res = makeCURLRequest($p);
        //p($res);
        if ($res['error'] == 0 && !empty($res['data'])) {
            $html = str_get_html($res['data']);
            foreach ($html->find('table[class="generic-table general-table"] tr') as $tr) {
                if ($tr->find('span', 0)) {
                    $history[regix_string($tr->find('span', 0)->plaintext)]['474']['diesel'] = trim($tr->find('span', 1)->plaintext);
                    $history[regix_string($tr->find('span', 0)->plaintext)]['351']['diesel'] = trim($tr->find('span', 2)->plaintext);
                    $history[regix_string($tr->find('span', 0)->plaintext)]['431']['diesel'] = trim($tr->find('span', 3)->plaintext);
                    $history[regix_string($tr->find('span', 0)->plaintext)]['122']['diesel'] = trim($tr->find('span', 4)->plaintext);
                }
            }
        }
        if ($check) {
            if (is_array($history) && count($history) > 0) {
                reset($history);
                $day = key($history);
                if (date('F d, Y', strtotime('-1 day')) == date('F d, Y', strtotime($day))) {
                    return true;
                } else {
                    return false;
                }
            } else {
                return false;
            }
        }
        p($history);
    }

}
